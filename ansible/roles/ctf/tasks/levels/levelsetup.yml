---


- name: "Adding group for {{ item.name }}"
  become: yes
  become_user: root
  group:
    name: "{{ item.user }}"
    state: present
  tags:
    - ctf1
    - ctfserver
    - ctflevels
    - "{{ item.user }}"

- name: "Adding user for {{ item.name }}"
  become: yes
  become_user: root
  user:
    comment: "{{ item.name }}"
    name: "{{ item.user }}"
    password: "{{ item.password }}"
    state: present
    createhome: yes
    shell: /usr/bin/zsh
    update_password: always
    groups: "{{item.groups}},{{default_ctfuser_group}}"
    append: yes
  tags:
    - ctf1
    - ctfserver
    - ctflevels
    - "{{ item.user }}"


- name: "Copy the motd.txt for {{ item.name }}"
  template: src=motd.txt.j2 dest=/home/{{item.user}}/motd.txt owner=root mode=0644
  tags:
    - ctf1
    - ctfserver
    - ctflevels
    - "{{ item.user }}"

- name: "Copy the recap.txt for {{ item.name }}"
  ignore_errors: True
  copy: src=levels/{{item.user}}/recap.txt dest=/home/{{item.user}}/recap.txt owner=root mode=0644
  tags:
    - ctf1
    - ctfserver
    - ctflevels
    - "{{ item.user }}"

